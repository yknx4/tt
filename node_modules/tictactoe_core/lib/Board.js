'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _Base2 = require('./Base');

var _Base3 = _interopRequireDefault(_Base2);

var _ParameterValidation = require('./validation/ParameterValidation.js');

var _ParameterValidation2 = _interopRequireDefault(_ParameterValidation);

var _underscore = require('underscore');

var _underscore2 = _interopRequireDefault(_underscore);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var Board = function (_Base) {
  _inherits(Board, _Base);

  function Board(width, height) {
    _classCallCheck(this, Board);

    var _this = _possibleConstructorReturn(this, (Board.__proto__ || Object.getPrototypeOf(Board)).call(this));

    width = width || 3;
    height = height || width;
    _this._validateInput(width, height);
    _this._setupDimensions(width, height);
    _this._field = {};
    return _this;
  }

  _createClass(Board, [{
    key: '_validateInput',
    value: function _validateInput(width, height) {
      _ParameterValidation2.default.validateDimension(width, 'width');
      _ParameterValidation2.default.validateDimension(height, 'height');
    }
  }, {
    key: '_setupDimensions',
    value: function _setupDimensions(width, height) {
      this._width = width;
      this._height = height;
    }
  }, {
    key: 'getCell',
    value: function getCell(x, y) {
      if (this._xyIsOccupied(x, y)) {
        return this._field[x][y];
      }
      return undefined;
    }
  }, {
    key: 'play',
    value: function play(id, x, y) {
      x = parseInt(x, 10);
      y = parseInt(y, 10);
      this._validatePosition(x, y);

      var field = this._field;

      if (_underscore2.default.isUndefined(field[x])) {
        field[x] = {};
      }

      field[x][y] = id;
    }
  }, {
    key: '_validatePosition',
    value: function _validatePosition(x, y) {
      var xIsInvalid = x >= this.width;
      var yIsInvalid = y >= this.height;
      if (xIsInvalid || yIsInvalid) {
        throw new RangeError('(' + x + ',' + y + ') is outside the field. (' + this.width + 'x' + this.height + ')');
      }

      if (this._xyIsOccupied(x, y)) {
        throw new Error('(' + x + ',' + y + ') is already set to \'' + this.getCell(x, y) + '\'.');
      }
    }
  }, {
    key: '_xyIsOccupied',
    value: function _xyIsOccupied(x, y) {
      var xExists = !_underscore2.default.isUndefined(this._field[x]);
      return xExists && !_underscore2.default.isUndefined(this._field[x][y]);
    }
  }, {
    key: 'width',
    get: function get() {
      return this._width;
    }
  }, {
    key: 'height',
    get: function get() {
      return this._height;
    }
  }, {
    key: 'count',
    get: function get() {
      return _underscore2.default.flatten(_underscore2.default.map(_underscore2.default.values(this._field), function (row) {
        return _underscore2.default.values(row);
      })).length;
    }
  }]);

  return Board;
}(_Base3.default);

exports.default = Board;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9Cb2FyZC5qcyJdLCJuYW1lcyI6WyJCb2FyZCIsIndpZHRoIiwiaGVpZ2h0IiwiX3ZhbGlkYXRlSW5wdXQiLCJfc2V0dXBEaW1lbnNpb25zIiwiX2ZpZWxkIiwidmFsaWRhdGVEaW1lbnNpb24iLCJfd2lkdGgiLCJfaGVpZ2h0IiwieCIsInkiLCJfeHlJc09jY3VwaWVkIiwidW5kZWZpbmVkIiwiaWQiLCJwYXJzZUludCIsIl92YWxpZGF0ZVBvc2l0aW9uIiwiZmllbGQiLCJpc1VuZGVmaW5lZCIsInhJc0ludmFsaWQiLCJ5SXNJbnZhbGlkIiwiUmFuZ2VFcnJvciIsIkVycm9yIiwiZ2V0Q2VsbCIsInhFeGlzdHMiLCJmbGF0dGVuIiwibWFwIiwidmFsdWVzIiwicm93IiwibGVuZ3RoIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBOzs7O0FBQ0E7Ozs7QUFDQTs7Ozs7Ozs7Ozs7O0lBRXFCQSxLOzs7QUFFbkIsaUJBQVlDLEtBQVosRUFBbUJDLE1BQW5CLEVBQTJCO0FBQUE7O0FBQUE7O0FBRXpCRCxZQUFRQSxTQUFTLENBQWpCO0FBQ0FDLGFBQVNBLFVBQVVELEtBQW5CO0FBQ0EsVUFBS0UsY0FBTCxDQUFvQkYsS0FBcEIsRUFBMkJDLE1BQTNCO0FBQ0EsVUFBS0UsZ0JBQUwsQ0FBc0JILEtBQXRCLEVBQTZCQyxNQUE3QjtBQUNBLFVBQUtHLE1BQUwsR0FBYyxFQUFkO0FBTnlCO0FBTzFCOzs7O21DQUVjSixLLEVBQU9DLE0sRUFBUTtBQUM1QixvQ0FBb0JJLGlCQUFwQixDQUFzQ0wsS0FBdEMsRUFBNkMsT0FBN0M7QUFDQSxvQ0FBb0JLLGlCQUFwQixDQUFzQ0osTUFBdEMsRUFBOEMsUUFBOUM7QUFDRDs7O3FDQUVnQkQsSyxFQUFPQyxNLEVBQVE7QUFDOUIsV0FBS0ssTUFBTCxHQUFjTixLQUFkO0FBQ0EsV0FBS08sT0FBTCxHQUFlTixNQUFmO0FBQ0Q7Ozs0QkFVT08sQyxFQUFHQyxDLEVBQUc7QUFDWixVQUFJLEtBQUtDLGFBQUwsQ0FBbUJGLENBQW5CLEVBQXNCQyxDQUF0QixDQUFKLEVBQThCO0FBQzVCLGVBQU8sS0FBS0wsTUFBTCxDQUFZSSxDQUFaLEVBQWVDLENBQWYsQ0FBUDtBQUNEO0FBQ0QsYUFBT0UsU0FBUDtBQUNEOzs7eUJBRUlDLEUsRUFBSUosQyxFQUFHQyxDLEVBQUc7QUFDYkQsVUFBSUssU0FBU0wsQ0FBVCxFQUFZLEVBQVosQ0FBSjtBQUNBQyxVQUFJSSxTQUFTSixDQUFULEVBQVksRUFBWixDQUFKO0FBQ0EsV0FBS0ssaUJBQUwsQ0FBdUJOLENBQXZCLEVBQTBCQyxDQUExQjs7QUFFQSxVQUFJTSxRQUFRLEtBQUtYLE1BQWpCOztBQUVBLFVBQUkscUJBQUVZLFdBQUYsQ0FBY0QsTUFBTVAsQ0FBTixDQUFkLENBQUosRUFBNkI7QUFDM0JPLGNBQU1QLENBQU4sSUFBVyxFQUFYO0FBQ0Q7O0FBRURPLFlBQU1QLENBQU4sRUFBU0MsQ0FBVCxJQUFjRyxFQUFkO0FBQ0Q7OztzQ0FFaUJKLEMsRUFBR0MsQyxFQUFHO0FBQ3RCLFVBQUlRLGFBQWFULEtBQUssS0FBS1IsS0FBM0I7QUFDQSxVQUFJa0IsYUFBYVQsS0FBSyxLQUFLUixNQUEzQjtBQUNBLFVBQUlnQixjQUFjQyxVQUFsQixFQUE4QjtBQUM1QixjQUFNLElBQUlDLFVBQUosT0FBbUJYLENBQW5CLFNBQXdCQyxDQUF4QixpQ0FBcUQsS0FBS1QsS0FBMUQsU0FBbUUsS0FBS0MsTUFBeEUsT0FBTjtBQUNEOztBQUVELFVBQUksS0FBS1MsYUFBTCxDQUFtQkYsQ0FBbkIsRUFBc0JDLENBQXRCLENBQUosRUFBOEI7QUFDNUIsY0FBTSxJQUFJVyxLQUFKLE9BQWNaLENBQWQsU0FBbUJDLENBQW5CLDhCQUE0QyxLQUFLWSxPQUFMLENBQWFiLENBQWIsRUFBZ0JDLENBQWhCLENBQTVDLFNBQU47QUFDRDtBQUNGOzs7a0NBRWFELEMsRUFBR0MsQyxFQUFHO0FBQ2xCLFVBQUlhLFVBQVUsQ0FBQyxxQkFBRU4sV0FBRixDQUFjLEtBQUtaLE1BQUwsQ0FBWUksQ0FBWixDQUFkLENBQWY7QUFDQSxhQUFPYyxXQUFXLENBQUMscUJBQUVOLFdBQUYsQ0FBYyxLQUFLWixNQUFMLENBQVlJLENBQVosRUFBZUMsQ0FBZixDQUFkLENBQW5CO0FBQ0Q7Ozt3QkE1Q1c7QUFDVixhQUFPLEtBQUtILE1BQVo7QUFDRDs7O3dCQUVZO0FBQ1gsYUFBTyxLQUFLQyxPQUFaO0FBQ0Q7Ozt3QkF3Q1c7QUFDVixhQUFPLHFCQUFFZ0IsT0FBRixDQUFVLHFCQUFFQyxHQUFGLENBQU0scUJBQUVDLE1BQUYsQ0FBUyxLQUFLckIsTUFBZCxDQUFOLEVBQTZCLGVBQU87QUFDbkQsZUFBTyxxQkFBRXFCLE1BQUYsQ0FBU0MsR0FBVCxDQUFQO0FBQ0QsT0FGZ0IsQ0FBVixFQUVIQyxNQUZKO0FBR0Q7Ozs7OztrQkF2RWtCNUIsSyIsImZpbGUiOiJCb2FyZC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBCYXNlIGZyb20gJy4vQmFzZSdcbmltcG9ydCBQYXJhbWV0ZXJWYWxpZGF0aW9uIGZyb20gJy4vdmFsaWRhdGlvbi9QYXJhbWV0ZXJWYWxpZGF0aW9uLmpzJ1xuaW1wb3J0IF8gZnJvbSAndW5kZXJzY29yZSdcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQm9hcmQgZXh0ZW5kcyBCYXNlIHtcblxuICBjb25zdHJ1Y3Rvcih3aWR0aCwgaGVpZ2h0KSB7XG4gICAgc3VwZXIoKVxuICAgIHdpZHRoID0gd2lkdGggfHwgM1xuICAgIGhlaWdodCA9IGhlaWdodCB8fCB3aWR0aFxuICAgIHRoaXMuX3ZhbGlkYXRlSW5wdXQod2lkdGgsIGhlaWdodClcbiAgICB0aGlzLl9zZXR1cERpbWVuc2lvbnMod2lkdGgsIGhlaWdodClcbiAgICB0aGlzLl9maWVsZCA9IHt9XG4gIH1cblxuICBfdmFsaWRhdGVJbnB1dCh3aWR0aCwgaGVpZ2h0KSB7XG4gICAgUGFyYW1ldGVyVmFsaWRhdGlvbi52YWxpZGF0ZURpbWVuc2lvbih3aWR0aCwgJ3dpZHRoJylcbiAgICBQYXJhbWV0ZXJWYWxpZGF0aW9uLnZhbGlkYXRlRGltZW5zaW9uKGhlaWdodCwgJ2hlaWdodCcpXG4gIH1cblxuICBfc2V0dXBEaW1lbnNpb25zKHdpZHRoLCBoZWlnaHQpIHtcbiAgICB0aGlzLl93aWR0aCA9IHdpZHRoXG4gICAgdGhpcy5faGVpZ2h0ID0gaGVpZ2h0XG4gIH1cblxuICBnZXQgd2lkdGgoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3dpZHRoXG4gIH1cblxuICBnZXQgaGVpZ2h0KCkge1xuICAgIHJldHVybiB0aGlzLl9oZWlnaHRcbiAgfVxuXG4gIGdldENlbGwoeCwgeSkge1xuICAgIGlmICh0aGlzLl94eUlzT2NjdXBpZWQoeCwgeSkpIHtcbiAgICAgIHJldHVybiB0aGlzLl9maWVsZFt4XVt5XVxuICAgIH1cbiAgICByZXR1cm4gdW5kZWZpbmVkXG4gIH1cblxuICBwbGF5KGlkLCB4LCB5KSB7XG4gICAgeCA9IHBhcnNlSW50KHgsIDEwKVxuICAgIHkgPSBwYXJzZUludCh5LCAxMClcbiAgICB0aGlzLl92YWxpZGF0ZVBvc2l0aW9uKHgsIHkpXG5cbiAgICBsZXQgZmllbGQgPSB0aGlzLl9maWVsZFxuXG4gICAgaWYgKF8uaXNVbmRlZmluZWQoZmllbGRbeF0pKSB7XG4gICAgICBmaWVsZFt4XSA9IHt9XG4gICAgfVxuXG4gICAgZmllbGRbeF1beV0gPSBpZFxuICB9XG5cbiAgX3ZhbGlkYXRlUG9zaXRpb24oeCwgeSkge1xuICAgIGxldCB4SXNJbnZhbGlkID0geCA+PSB0aGlzLndpZHRoXG4gICAgbGV0IHlJc0ludmFsaWQgPSB5ID49IHRoaXMuaGVpZ2h0XG4gICAgaWYgKHhJc0ludmFsaWQgfHwgeUlzSW52YWxpZCkge1xuICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoYCgke3h9LCR7eX0pIGlzIG91dHNpZGUgdGhlIGZpZWxkLiAoJHt0aGlzLndpZHRofXgke3RoaXMuaGVpZ2h0fSlgKVxuICAgIH1cblxuICAgIGlmICh0aGlzLl94eUlzT2NjdXBpZWQoeCwgeSkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgKCR7eH0sJHt5fSkgaXMgYWxyZWFkeSBzZXQgdG8gJyR7dGhpcy5nZXRDZWxsKHgsIHkpfScuYClcbiAgICB9XG4gIH1cblxuICBfeHlJc09jY3VwaWVkKHgsIHkpIHtcbiAgICBsZXQgeEV4aXN0cyA9ICFfLmlzVW5kZWZpbmVkKHRoaXMuX2ZpZWxkW3hdKVxuICAgIHJldHVybiB4RXhpc3RzICYmICFfLmlzVW5kZWZpbmVkKHRoaXMuX2ZpZWxkW3hdW3ldKVxuICB9XG5cbiAgZ2V0IGNvdW50KCkge1xuICAgIHJldHVybiBfLmZsYXR0ZW4oXy5tYXAoXy52YWx1ZXModGhpcy5fZmllbGQpLCByb3cgPT4ge1xuICAgICAgcmV0dXJuIF8udmFsdWVzKHJvdylcbiAgICB9KSkubGVuZ3RoXG4gIH1cblxufVxuIl19
//# sourceMappingURL=Board.js.map